<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Under Construction - Stardew Labs</title>
        <style>
            :root {
                --font-mono:
                    monospace, -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Arial, sans-serif;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background: #0a0a1a;
                color: white;
                font-family: var(--font-mono);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .hero {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 40px 20px;
                position: relative;
                overflow: hidden;
                background: linear-gradient(
                    to bottom,
                    #0a0a1a 0%,
                    #0d0d24 40%,
                    #12152e 85%,
                    #1a1e32 100%
                );
            }

            .night-sky {
                position: absolute;
                bottom: 0;
                left: 50%;
                /* Width, height, and bottom offset set dynamically by JavaScript */
                transform-origin: 50% 50%;
                animation: rotateSky 900s linear infinite;
                will-change: transform;
                transform: translate3d(-50%, 0, 0);
                contain: layout style paint;
            }

            @keyframes rotateSky {
                from {
                    transform: translate3d(-50%, 0, 0) rotate(0deg);
                }
                to {
                    transform: translate3d(-50%, 0, 0) rotate(360deg);
                }
            }

            .sky-star {
                position: absolute;
                background: white;
                border-radius: 50%;
                animation: twinkle 6s ease-in-out infinite;
                will-change: opacity;
            }

            .paused {
                animation-play-state: paused !important;
            }

            .paused * {
                animation-play-state: paused !important;
            }

            .meteors-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 2;
                contain: layout style paint;
            }

            .meteor {
                position: absolute;
                opacity: 0;
                will-change: transform, opacity;
            }

            .meteor-head {
                width: 4px;
                height: 4px;
                background: radial-gradient(
                    circle,
                    white,
                    rgba(255, 255, 255, 0.8)
                );
                border-radius: 50%;
                box-shadow: 0 0 4px rgba(255, 255, 255, 0.6);
            }

            .meteor-tail {
                position: absolute;
                top: 50%;
                left: -70px;
                width: 60px;
                height: 2px;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 200, 150, 0.2) 30%,
                    rgba(255, 220, 180, 0.4) 70%,
                    transparent 95%
                );
                transform: translateY(-50%);
                filter: blur(0.5px);
            }

            .logo-container {
                text-align: center;
                max-width: 1200px;
                width: 100%;
                position: relative;
                z-index: 3;
            }

            .logo-text {
                font-size: clamp(60px, 15vw, 180px);
                font-weight: 900;
                letter-spacing: 0.02em;
                line-height: 1.1;
                display: block;
            }

            .horizon {
                height: 1px;
                background: linear-gradient(
                    to right,
                    transparent,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent
                );
                position: relative;
                z-index: 4;
            }

            .content {
                background: linear-gradient(
                    to bottom,
                    #1f2238 0%,
                    #282a38 30%,
                    #2d2f3a 70%,
                    #2d2f3a 100%
                );
                padding: 40px 20px 60px;
                position: relative;
                z-index: 4;
            }

            .content-wrapper {
                max-width: 1200px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
                align-items: start;
            }

            .right-content p {
                font-family: var(--font-mono);
                font-size: clamp(18px, 2.5vw, 24px);
                line-height: 1.1;
                text-align: right;
            }

            .left-content p {
                font-family: var(--font-mono);
                font-size: clamp(18px, 2.5vw, 24px);
                line-height: 1.6;
                text-align: left;
            }

            .contact {
                font-size: 16px;
                line-height: 1.8;
                margin-top: 30px;
            }

            .contact strong {
                display: block;
                margin-bottom: 5px;
            }

            .contact a {
                color: white;
                text-decoration: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.3);
                transition: border-color 0.3s;
            }

            .contact a:hover {
                border-bottom-color: white;
            }

            @media (max-width: 768px) {
                .content-wrapper {
                    grid-template-columns: 1fr;
                    gap: 20px;
                }

                .logo-text {
                    letter-spacing: 0;
                }
            }
        </style>
    </head>
    <body>
        <div class="hero">
            <div class="night-sky" id="nightSky"></div>
            <div class="meteors-container" id="meteorsContainer"></div>
            <div class="logo-container">
                <div class="logo-text">STARDEW LABS</div>
            </div>
        </div>

        <div class="horizon"></div>

        <div class="content">
            <div class="content-wrapper">
                <div class="left-content">
                    <p>
                        Ignition is imminent. We (Neehar + Tara) are cooking up
                        something new â€“ watch this space!
                    </p>
                </div>
                <div class="right-content">
                    <div class="contact">
                        <strong>In the meantime, reach us at:</strong>
                        <a href="mailto:hello@stardew.work"
                            >hello@stardew.work</a
                        >
                    </div>
                </div>
            </div>
        </div>
        <script>
            // Configuration object
            const CONFIG = {
                stars: {
                    countDesktop: 300,
                    countMobile: 150,
                    mobileBreakpoint: 768,
                    maxSize: 3,
                    minSize: 1,
                    animationDelayMax: 6,
                    animationDurationMin: 4,
                    animationDurationMax: 10,
                    twinkleOpacityMin: 0.4,
                    twinkleOpacityMax: 1.0,
                    staticPercentage: 0.30,
                    staticOpacityMin: 0.4,
                    staticOpacityMax: 0.7,
                },
                meteors: {
                    startXMin: 90,
                    startXMax: 120,
                    startYMin: {
                        whenXOutOfBounds: -10,
                        whenXInBounds: -40,
                    },
                    startYMax: 50,
                    angleMin: 130,
                    angleMax: 160,
                    angleVariation: 15,
                    durationMin: 4,
                    durationMax: 6,
                    showerCountMin: 6,
                    showerCountMax: 12,
                    showerIntervalMin: 80,
                    showerIntervalMax: 230,
                    singleMeteorIntervalMin: 1500,
                    singleMeteorIntervalMax: 5500,
                    nextShowerMin: 3000,
                    nextShowerMax: 8000,
                    singleMeteorStreamCount: 2,
                    initialMeteorDelayMax: 2000,
                    initialShowerDelayMin: 2000,
                    initialShowerDelayMax: 4000,
                    showerCleanupDelayPerMeteor: 250,
                    showerCleanupDelayBase: 2000,
                },
                performance: {
                    resizeDebounceMs: 250,
                },
            };

            // Calculate and set optimal night sky container size
            function initializeNightSkySize() {
                try {
                    const hero = document.querySelector(".hero");
                    const nightSky = document.getElementById("nightSky");

                    if (!hero || !nightSky) {
                        throw new Error("Hero or night sky element not found");
                    }

                    const heroRect = hero.getBoundingClientRect();
                    const heroWidth = heroRect.width;
                    const heroHeight = heroRect.height;

                    // Calculate diagonal from horizon (bottom-center) to top corners
                    const diagonal = Math.sqrt(
                        (heroWidth / 2) ** 2 + heroHeight ** 2,
                    );

                    // Container rotates from center, positioned at horizon
                    const containerSize = Math.ceil(diagonal * 2.2);

                    // Apply dimensions and position center at horizon
                    nightSky.style.width = `${containerSize}px`;
                    nightSky.style.height = `${containerSize}px`;
                    nightSky.style.bottom = `${-containerSize / 2}px`;
                } catch (error) {
                    console.error(
                        "Failed to initialize night sky size:",
                        error,
                    );
                }
            }

            // Get appropriate star count based on device width
            function getStarCount() {
                return window.innerWidth < CONFIG.stars.mobileBreakpoint
                    ? CONFIG.stars.countMobile
                    : CONFIG.stars.countDesktop;
            }

            // Generate twinkle keyframes dynamically from CONFIG
            function generateTwinkleKeyframes() {
                try {
                    const keyframesCSS = `
                        @keyframes twinkle {
                            0%, 100% {
                                opacity: ${CONFIG.stars.twinkleOpacityMin};
                            }
                            50% {
                                opacity: ${CONFIG.stars.twinkleOpacityMax};
                            }
                        }
                    `;

                    // Remove old keyframes if they exist
                    const oldStyle = document.getElementById("twinkle-keyframes");
                    if (oldStyle) oldStyle.remove();

                    // Add new keyframes
                    const style = document.createElement("style");
                    style.id = "twinkle-keyframes";
                    style.textContent = keyframesCSS;
                    document.head.appendChild(style);
                } catch (error) {
                    console.error("Failed to generate twinkle keyframes:", error);
                }
            }

            // Create fixed night sky stars with error handling
            function initializeStars() {
                try {
                    const nightSky = document.getElementById("nightSky");
                    if (!nightSky) {
                        throw new Error("Night sky element not found");
                    }

                    const numSkyStars = getStarCount();
                    const fragment = document.createDocumentFragment();

                    for (let i = 0; i < numSkyStars; i++) {
                        const star = document.createElement("div");
                        star.className = "sky-star";

                        // Random position with bias toward top half (visible area)
                        star.style.left = Math.random() * 100 + "%";
                        star.style.top =
                            Math.pow(Math.random(), 1.5) * 100 + "%";

                        // Varied sizes
                        const size =
                            CONFIG.stars.minSize +
                            Math.random() *
                                (CONFIG.stars.maxSize - CONFIG.stars.minSize);
                        star.style.width = size + "px";
                        star.style.height = size + "px";

                        // Make some stars static (non-twinkling)
                        const isStatic = Math.random() < CONFIG.stars.staticPercentage;
                        if (isStatic) {
                            star.style.animation = "none";
                            star.style.opacity =
                                CONFIG.stars.staticOpacityMin +
                                Math.random() * (CONFIG.stars.staticOpacityMax - CONFIG.stars.staticOpacityMin);
                        } else {
                            // Varied animation delay for twinkling
                            star.style.animationDelay =
                                Math.random() * CONFIG.stars.animationDelayMax +
                                "s";
                            star.style.animationDuration =
                                CONFIG.stars.animationDurationMin +
                                Math.random() *
                                    (CONFIG.stars.animationDurationMax -
                                        CONFIG.stars.animationDurationMin) +
                                "s";
                        }

                        fragment.appendChild(star);
                    }

                    nightSky.appendChild(fragment);
                } catch (error) {
                    console.error("Failed to initialize stars:", error);
                }
            }

            // Initialize night sky size and stars
            initializeNightSkySize();
            generateTwinkleKeyframes();
            initializeStars();

            // Cache DOM elements with error handling
            let meteorsContainer, heroElement, heroDiagonal;
            let isShowerActive = false;
            const METEOR_ANGLES = [130, 135, 140, 145, 150, 155, 160, 165];
            const DISTANCE_TIERS = ["short", "med", "long"];

            // Visibility tracking for pause/resume
            let isPageVisible = !document.hidden;
            let activeMeteorTimeouts = [];
            let activeShowerTimeouts = [];

            function initializeMeteorSystem() {
                try {
                    meteorsContainer =
                        document.getElementById("meteorsContainer");
                    heroElement = document.getElementsByClassName("hero")[0];

                    if (!meteorsContainer) {
                        throw new Error("Meteors container not found");
                    }
                    if (!heroElement) {
                        throw new Error("Hero element not found");
                    }

                    // Cache hero dimensions
                    const heroRect = heroElement.getBoundingClientRect();
                    const heroWidth = heroRect.width;
                    const heroHeight = heroRect.height;
                    heroDiagonal = Math.sqrt(heroWidth ** 2 + heroHeight ** 2);

                    return true;
                } catch (error) {
                    console.error("Failed to initialize meteor system:", error);
                    return false;
                }
            }

            function generateMeteorKeyframes() {
                try {
                    if (!heroDiagonal) {
                        console.warn("heroDiagonal not initialized");
                        return;
                    }

                    const distances = {
                        short: heroDiagonal - 25,
                        med: heroDiagonal,
                        long: heroDiagonal + 25,
                    };

                    let keyframesCSS = "";

                    METEOR_ANGLES.forEach((angle) => {
                        const radians = (angle * Math.PI) / 180;

                        DISTANCE_TIERS.forEach((tier) => {
                            const distance = distances[tier];
                            const endX = Math.cos(radians) * distance;
                            const endY = Math.sin(radians) * distance;

                            keyframesCSS += `
                            @keyframes meteor-${angle}-${tier} {
                                0% {
                                    opacity: 0;
                                    transform: translate3d(0, 0, 0) rotate(${angle}deg);
                                }
                                5% {
                                    opacity: 1;
                                }
                                95% {
                                    opacity: 1;
                                }
                                100% {
                                    opacity: 0;
                                    transform: translate3d(${endX}px, ${endY}px, 0) rotate(${angle}deg);
                                }
                            }
                            `;
                        });
                    });

                    // Remove old keyframes if they exist
                    const oldStyle =
                        document.getElementById("meteor-keyframes");
                    if (oldStyle) oldStyle.remove();

                    // Add new keyframes
                    const style = document.createElement("style");
                    style.id = "meteor-keyframes";
                    style.textContent = keyframesCSS;
                    document.head.appendChild(style);
                } catch (error) {
                    console.error(
                        "Failed to generate meteor keyframes:",
                        error,
                    );
                }
            }

            function calculateMeteorStartPosition() {
                const startX =
                    CONFIG.meteors.startXMax -
                    Math.random() *
                        (CONFIG.meteors.startXMax - CONFIG.meteors.startXMin);
                let startY;
                if (startX < 100) {
                    startY =
                        CONFIG.meteors.startYMin.whenXInBounds +
                        Math.random() *
                            (CONFIG.meteors.startYMax -
                                CONFIG.meteors.startYMin.whenXInBounds);
                } else {
                    startY =
                        CONFIG.meteors.startYMin.whenXOutOfBounds +
                        Math.random() *
                            (CONFIG.meteors.startYMax -
                                CONFIG.meteors.startYMin.whenXOutOfBounds);
                }
                return { x: startX, y: startY };
            }

            function selectMeteorAngle(baseAngle = null) {
                if (baseAngle !== null) {
                    // For meteor showers, find closest preset angle to baseAngle
                    return METEOR_ANGLES.reduce((prev, curr) =>
                        Math.abs(curr - baseAngle) < Math.abs(prev - baseAngle)
                            ? curr
                            : prev,
                    );
                } else {
                    // Random angle from preset pool
                    return METEOR_ANGLES[
                        Math.floor(Math.random() * METEOR_ANGLES.length)
                    ];
                }
            }

            function createMeteorElements() {
                const meteor = document.createElement("div");
                meteor.className = "meteor";

                const head = document.createElement("div");
                head.className = "meteor-head";
                const tail = document.createElement("div");
                tail.className = "meteor-tail";
                meteor.appendChild(head);
                meteor.appendChild(tail);

                return meteor;
            }

            function selectMeteorAnimation(angle) {
                const distanceTier =
                    DISTANCE_TIERS[
                        Math.floor(Math.random() * DISTANCE_TIERS.length)
                    ];
                return `meteor-${angle}-${distanceTier}`;
            }

            function createMeteor(baseAngle = null) {
                try {
                    if (!meteorsContainer || !heroDiagonal) {
                        console.warn("Meteor system not properly initialized");
                        return;
                    }

                    const meteor = createMeteorElements();
                    const startPos = calculateMeteorStartPosition();

                    meteor.style.left = startPos.x + "%";
                    meteor.style.top = startPos.y + "%";

                    const angle = selectMeteorAngle(baseAngle);
                    const animationName = selectMeteorAnimation(angle);

                    const duration =
                        CONFIG.meteors.durationMin +
                        Math.random() *
                            (CONFIG.meteors.durationMax -
                                CONFIG.meteors.durationMin);
                    meteor.style.animation = `${animationName} ${duration}s linear forwards`;

                    meteorsContainer.appendChild(meteor);

                    setTimeout(() => {
                        try {
                            if (meteor.parentNode) meteor.remove();
                        } catch (cleanupError) {
                            console.warn(
                                "Error during meteor cleanup:",
                                cleanupError,
                            );
                        }
                    }, duration * 1000);
                } catch (error) {
                    console.error("Error creating meteor:", error);
                }
            }

            function triggerMeteorShower() {
                if (isShowerActive || !isPageVisible) return;

                isShowerActive = true;
                const showerAngle =
                    CONFIG.meteors.angleMin +
                    Math.random() *
                        (CONFIG.meteors.angleMax - CONFIG.meteors.angleMin);
                const numMeteors =
                    CONFIG.meteors.showerCountMin +
                    Math.floor(
                        Math.random() *
                            (CONFIG.meteors.showerCountMax -
                                CONFIG.meteors.showerCountMin +
                                1),
                    );

                for (let i = 0; i < numMeteors; i++) {
                    const timeoutId = setTimeout(
                        () => {
                            if (isPageVisible) createMeteor(showerAngle);
                        },
                        i *
                            (CONFIG.meteors.showerIntervalMin +
                                Math.random() *
                                    (CONFIG.meteors.showerIntervalMax -
                                        CONFIG.meteors.showerIntervalMin)),
                    );
                    activeShowerTimeouts.push(timeoutId);
                }

                const cleanupTimeoutId = setTimeout(
                    () => {
                        isShowerActive = false;
                        scheduleNextShower();
                    },
                    numMeteors * CONFIG.meteors.showerCleanupDelayPerMeteor + CONFIG.meteors.showerCleanupDelayBase,
                );
                activeShowerTimeouts.push(cleanupTimeoutId);
            }

            function scheduleNextShower() {
                if (!isPageVisible) return;
                const nextShowerIn =
                    CONFIG.meteors.nextShowerMin +
                    Math.random() *
                        (CONFIG.meteors.nextShowerMax -
                            CONFIG.meteors.nextShowerMin);
                const timeoutId = setTimeout(triggerMeteorShower, nextShowerIn);
                activeShowerTimeouts.push(timeoutId);
            }

            function createSingleMeteor() {
                if (!isPageVisible) return;
                createMeteor();
                const nextMeteorIn =
                    CONFIG.meteors.singleMeteorIntervalMin +
                    Math.random() *
                        (CONFIG.meteors.singleMeteorIntervalMax -
                            CONFIG.meteors.singleMeteorIntervalMin);
                const timeoutId = setTimeout(createSingleMeteor, nextMeteorIn);
                activeMeteorTimeouts.push(timeoutId);
            }

            // Initialize meteor system and start animations
            if (initializeMeteorSystem()) {
                // Generate keyframes once
                generateMeteorKeyframes();

                // Track current star count for breakpoint detection
                let currentStarCount = getStarCount();

                // Add resize listener with debouncing
                let resizeTimeout;
                window.addEventListener("resize", () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        // Update night sky size
                        initializeNightSkySize();

                        // Check if we crossed the mobile breakpoint
                        const newStarCount = getStarCount();
                        if (newStarCount !== currentStarCount) {
                            currentStarCount = newStarCount;
                            // Regenerate stars with new count
                            const nightSky = document.getElementById("nightSky");
                            if (nightSky) {
                                // Remove old stars
                                const oldStars = nightSky.querySelectorAll(".sky-star");
                                oldStars.forEach(star => star.remove());
                                // Regenerate with new count
                                initializeStars();
                            }
                        }

                        // Update meteor system
                        const heroRect = heroElement.getBoundingClientRect();
                        const heroWidth = heroRect.width;
                        const heroHeight = heroRect.height;
                        heroDiagonal = Math.sqrt(
                            heroWidth ** 2 + heroHeight ** 2,
                        );
                        generateMeteorKeyframes();
                    }, CONFIG.performance.resizeDebounceMs);
                });

                // Visibility change handler for pause/resume
                document.addEventListener("visibilitychange", () => {
                    const nightSky = document.getElementById("nightSky");
                    const meteorsContainer = document.getElementById("meteorsContainer");

                    if (document.hidden) {
                        // Page is hidden - pause animations
                        isPageVisible = false;
                        if (nightSky) nightSky.classList.add("paused");
                        if (meteorsContainer) meteorsContainer.classList.add("paused");

                        // Clear all pending meteor timeouts
                        activeMeteorTimeouts.forEach(clearTimeout);
                        activeShowerTimeouts.forEach(clearTimeout);
                        activeMeteorTimeouts = [];
                        activeShowerTimeouts = [];
                    } else {
                        // Page is visible - resume animations
                        isPageVisible = true;
                        if (nightSky) nightSky.classList.remove("paused");
                        if (meteorsContainer) meteorsContainer.classList.remove("paused");

                        // Restart meteor creation
                        if (!isShowerActive) {
                            // Restart single meteors
                            for (let i = 0; i < CONFIG.meteors.singleMeteorStreamCount; i++) {
                                setTimeout(createSingleMeteor, Math.random() * CONFIG.meteors.initialMeteorDelayMax);
                            }
                            // Restart showers
                            setTimeout(
                                triggerMeteorShower,
                                CONFIG.meteors.initialShowerDelayMin +
                                    Math.random() * (CONFIG.meteors.initialShowerDelayMax - CONFIG.meteors.initialShowerDelayMin)
                            );
                        }
                    }
                });

                // Start scattered single meteors
                for (let i = 0; i < CONFIG.meteors.singleMeteorStreamCount; i++) {
                    setTimeout(createSingleMeteor, Math.random() * CONFIG.meteors.initialMeteorDelayMax);
                }

                // Start first meteor shower
                setTimeout(
                    triggerMeteorShower,
                    CONFIG.meteors.initialShowerDelayMin +
                        Math.random() * (CONFIG.meteors.initialShowerDelayMax - CONFIG.meteors.initialShowerDelayMin)
                );
            }
        </script>
    </body>
</html>
